{% extends 'geco/base.html' %}
{% block content %}
      {% load static %}
        <link rel="stylesheet" type="text/css"
                               href="{% static 'geco/css/genomic-context.css' %}"/>

          <div class="loader"></div>

        <form
          action=""
          method="get"
          enctype="multipart/form-data"
          accept-charset="utf-8"
          target="_self"
          id="params"
        >
        <div id="submit-params">
        <div id="input-params">

          <div class="input-panel">
              <div class="panel-header">
                  Scale
              </div>

          <div class="nUpstream">
            <div class="custom-select" style="width:160px;">
            <select class="input" name="nUpstream" id="nUpstream"></select>
            </div>
          </div>
          <div class="nDownstream">
            <div class="custom-select" style="width:180px;">
            <select class="input" name="nDownstream" id="nDownstream"></select>
            </div>
          </div>
          <div class="distScale">
            <div class="custom-select" style="width:160px;">
            <select class="input" name="distScale" id="distScale">
                <option value="equiDist" 
                    selected disabled
                    >Gene distance</option>
                <option value="equiDist">equidistant</option>
                <option value="collapseDist">collapse</option>
                <option value="scaleDist">genomic distance</option>
            </select>
            </div>
          </div>
          <div>
          <div class="checkbox" style="width:100px">
              Gene by length
          </div>
          <label class="container">
              <input type="checkbox"  id="scaleSize">
              <span class="checkmark" id="scaleSize"></span>
          </label>
          </div>
          <div style="margin-top:10px;">
          <input type="text" 
                 value="" 
                 name="customScale" 
                 id="customScale"
                 placeholder="Custom min gene length (px)"
                 pattern="[0-9]*"
                 style="width:220px"/>
          </div>

          </div>
          <div class="input-panel">
              <div class="panel-header">
                  Display
              </div>

          <div>
          <div class="checkbox" style="width:30px">
              Tree
          </div>
          <label class="container">
              <input type="checkbox"  id="showTree" checked>
              <span class="checkmark" id="showTree"></span>
          </label>
          </div>
          <div>
          <div class="checkbox" style="width:75px">
              Gene name
          </div>
          <label class="container">
              <input type="checkbox"  id="geneName" checked>
              <span class="checkmark" id="geneName"></span>
          </label>
          </div>
          <div>
          <div class="checkbox" style="width:120px;">
              Number of contigs
          </div>
          <label class="container">
              <input type="checkbox"  id="nContig">
              <span class="checkmark" id="nContig"></span>
          </label>
          </div>
          <div>
          <div class="checkbox" style="width:115px;">
              Genomic position
          </div>
          <label class="container">
              <input type="checkbox"  id="showPos">
              <span class="checkmark" id="showPos"></span>
          </label>
          </div>
          <div>
          <div class="checkbox" style="width:110px;">
              Highlight anchor
          </div>
          <label class="container">
              <input type="checkbox"  id="highlightAnchor">
              <span class="checkmark" id="highlightAnchor"></span>
          </label>
          </div>


              
          </div>
          <div class="input-panel">
              <div class="panel-header">
                  Color
              </div>

          <div>
          <div class="tax-rank" style="display:inline-block;">
          <div class="custom-select" style="width:200px;">
              <select class="input" 
                  name="tax-rank" 
                  id="tax-rank"
                  disabled></select>
          </div>
          </div>
          <label class="container">
              <input type="checkbox"  id="tax-rank">
              <span class="checkmark" id="tax-rank"></span>
          </label>
          </div>
          <div class="notation">
            <div class="custom-select" style="width:180px;">
            <select class="input" name="notation" id="notation"></select>
            </div>
            <!--<div class="required" id="notation_alert"></div>-->
          </div>
          <div class="egg-level">
          <div class="custom-select" style="width:200px;">
              <select class="input" name="egg-level" id="egg-level"
                  disabled></select>
          </div>
          </div>
              
          </div>

        </div>
          <button type="submit">Submit</button>
        </div>
        </form>
      <div id="download-btns">
          <button class='download-btn' id="download-newick">Download Newick</button>
          <button class='download-btn' id="download-json">Download JSON</button>
          <button class='download-btn' id="download-tree">Download Tree</button>
          <button class='download-btn' id="download-context">Download graph</button>
      </div>
      <div id="graph">
        <div id="phylogram"></div>
        <div id="synteny"></div>
        <div class="legend">
            <div id="legend" class="sticky"></div>
        </div>
      </div>
      <script src="{% static 'geco/js/geco.js'%}"></script>
      <script charset="utf-8">
          async function custom_geco(selector) {
            var colors_file = "/static/geco/txt/colors.txt";
            var colors;
            await fetch(colors_file)
                .then(response => response.text())
                .then(hex => colors = eval(hex))
            var urlPath = window.location.pathname.split("/");
            let uploaded_url = String(urlPath[3]).replaceAll(",", "/");
            let inputfile;
            await fetch(uploaded_url)
                .then(response => response.text())
                .then(txt => inputfile = JSON.parse(txt))
            let newick;
            // GET NEWICK IF PROVIDED IN URL...
            await window.launch_GeCo(selector,
                                     inputfile, 
                                     newick,
                                     41, 
                                     colors);
            d3.select('ul.navbar')
                .style('visibility', 'visible')
                .style('opacity', 1);
        }


        custom_geco("body")

      </script>

{% endblock %}
